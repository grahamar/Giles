# --- !Ups

create table "USERS" ("USR_USERNAME" VARCHAR NOT NULL,"USR_EMAIL" VARCHAR NOT NULL,"USR_PWD" VARCHAR NOT NULL,"USR_FIRSTNAME" VARCHAR,"USR_LASTNAME" VARCHAR,"USR_HOMEPAGE" VARCHAR,"USR_JOINED" TIMESTAMP NOT NULL,"USR_SALT" VARCHAR NOT NULL,"id" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY);

create table "PROJECTS" ("PROJ_NAME" VARCHAR NOT NULL,"PROJ_SLUG" VARCHAR NOT NULL,"PROJ_URL" VARCHAR NOT NULL,"PROJ_DFLT_BRANCH" VARCHAR NOT NULL,"PROJ_DFLT_VERSION" VARCHAR NOT NULL,"PROJ_CREATED" TIMESTAMP NOT NULL,"PROJ_UPDATED" TIMESTAMP NOT NULL,"id" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY);

create unique index "idx_proj" on "PROJECTS" ("PROJ_NAME");

create unique index "idx_slug" on "PROJECTS" ("PROJ_SLUG");

create table "USER_PROJECTS" ("USR_ID" BIGINT NOT NULL,"PROJ_ID" BIGINT NOT NULL);

create table "PROJECT_VERSIONS" ("PROJ_ID" BIGINT NOT NULL,"VERSION" VARCHAR NOT NULL);

alter table "PROJECT_VERSIONS" add constraint "pk_proj_version" primary key("PROJ_ID","VERSION");

create table "BUILDS" ("BLD_PROJID" BIGINT NOT NULL,"BLD_VERSION" VARCHAR NOT NULL,"BLD_MSG" VARCHAR NOT NULL,"BLD_CREATED" TIMESTAMP NOT NULL,"BLD_STATUS" VARCHAR NOT NULL,"BLD_PAGE" VARCHAR,"id" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY);

alter table "USER_PROJECTS" add constraint "usr_fk" foreign key("USR_ID") references "USERS"("id") on update NO ACTION on delete NO ACTION;

alter table "USER_PROJECTS" add constraint "proj_fk" foreign key("PROJ_ID") references "PROJECTS"("id") on update NO ACTION on delete NO ACTION;

alter table "PROJECT_VERSIONS" add constraint "PROJ_FK" foreign key("PROJ_ID") references "PROJECTS"("id") on update NO ACTION on delete NO ACTION;